// Genre: IDM, Techno, Experimental | Character: Elektron Machinedrum-style kick - digital, versatile
define_synthdef("machinedrum_kick")
    .param("freq", 50.0)
    .param("amp", 1.0)
    .param("shape", 0.5)
    .body(|freq, amp, shape| {
        let gate = dc_ar(1.0);

        // Adjustable decay
        let decay = 0.3 + shape * 0.2;
        let amp_envelope = env_perc(0.001, 1.0);
        let amp_env = NewEnvGenBuilder(amp_envelope, gate)
            .with_time_scale(decay)
            .with_done_action(2.0)
            .build();

        // Pitch envelope with shape control
        let pitch_envelope = env_perc(0.001, 1.0);
        let pitch_env = NewEnvGenBuilder(pitch_envelope, gate)
            .with_time_scale(0.04 + shape * 0.04)
            .build();
        let freq_mod = pitch_env * freq * (2.5 + shape * 3.0);

        // Body with waveshaping based on shape
        let raw = sin_osc_ar(freq + freq_mod);
        let body = (raw * (1.0 + shape)).tanh() * 0.8;

        // Digital click
        let click_envelope = env_perc(0.0001, 0.005);
        let click_env = NewEnvGenBuilder(click_envelope, gate).build();
        let click = hpf_ar(white_noise_ar(), 2000.0) * click_env * shape * 0.2;

        (body + click) * amp_env * amp
    });
